<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reports</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================= BASE ================= */
body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:#f3f4f6;
    color:#111827;
}

/* ================= LAYOUT ================= */
.container{
    padding:12px 16px;
}

.section{
    background:#ffffff;
    border:1px solid #ccc;
    padding:12px;
    margin-bottom:12px;
}

.section-title{
    font-size:15px;
    font-weight:bold;
    margin-bottom:8px;
}

/* ================= GRID ================= */
.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:10px;
}

/* ================= INPUT ================= */
label{
    font-size:13px;
}
select,input{
    width:100%;
    padding:6px;
    font-size:13px;
}

/* ================= BUTTON ================= */
button{
    margin-top:10px;
    padding:8px 14px;
    font-size:13px;
    background:#2563eb;
    color:#fff;
    border:none;
    border-radius:4px;
    cursor:pointer;
}
button:hover{opacity:.9}

/* ================= NOTE ================= */
.note{
    font-size:12px;
    color:#555;
    margin-top:6px;
}
</style>
</head>

<body>

<!-- =====================================================
     LOGIN CHECK (STRICT)
===================================================== -->
<script>
(function(){
    if(sessionStorage.getItem("loggedIn") !== "true"){
        window.location.replace("login.html");
    }
})();
</script>

<!-- ================= HEADER ================= -->
<div id="header"></div>

<!-- ================= PAGE CONTENT ================= -->
<div class="container">

    <!-- ================= RECOVERY STATEMENT ================= -->
    <div class="section">
        <div class="section-title">Recovery Statement (Monthly)</div>

        <div class="grid">
            <div>
                <label>Month</label>
                <select id="recMonth"></select>
            </div>

            <div>
                <label>Department</label>
                <select id="recDept">
                    <option value="ALL">All</option>
                </select>
            </div>
        </div>

        <button onclick="downloadRecoveryStatement()">Download Excel</button>

        <div class="note">
            Monthly recovery statement for salary deduction.
        </div>
    </div>

    <!-- ================= RECOVERY SLIPS ================= -->
    <div class="section">
        <div class="section-title">Recovery Slips (Member-wise)</div>

        <div class="grid">
            <div>
                <label>Month</label>
                <select id="slipMonth"></select>
            </div>

            <div>
                <label>General No (optional)</label>
                <input id="slipMember" placeholder="Blank = All members">
            </div>
        </div>

        <button onclick="downloadRecoverySlips()">Download Excel</button>

        <div class="note">
            Individual member slips for distribution.
        </div>
    </div>

    <!-- ================= EMPLOYEE LIST ================= -->
    <div class="section">
        <div class="section-title">Employee List</div>

        <div class="grid">
            <div>
                <label>Status</label>
                <select id="empStatus">
                    <option value="ACTIVE">Active</option>
                    <option value="INACTIVE">Inactive</option>
                    <option value="ALL">All</option>
                </select>
            </div>

            <div>
                <label>Department</label>
                <select id="empDept">
                    <option value="ALL">All</option>
                </select>
            </div>
        </div>

        <button onclick="downloadEmployeeList()">Download Excel</button>

        <div class="note">
            Master member list for audit & AGM.
        </div>
    </div>

    <!-- ================= EMPLOYEE TYPE REPORT ================= -->
    <div class="section">
        <div class="section-title">Employee Type Report</div>

        <div class="grid">
            <div>
                <label>Employee Type</label>
                <select id="empType">
                    <option value="ALL">All</option>
                    <option value="Industrial">Industrial</option>
                    <option value="Non-Industrial">Non-Industrial</option>
                </select>
            </div>
        </div>

        <button onclick="downloadEmployeeTypeReport()">Download Excel</button>

        <div class="note">
            Employee classification report (type-wise).
        </div>
    </div>

    <div style="text-align:center;font-size:12px;color:#555;margin-top:20px;">
        Â© Society Management System | Reports Module
    </div>

</div>

<!-- =====================================================
     JAVASCRIPT
===================================================== -->
<script>
/* ================= LOAD HEADER ================= */
fetch("header.html")
.then(r=>{
    if(!r.ok) throw new Error();
    return r.text();
})
.then(h=>document.getElementById("header").innerHTML=h)
.catch(()=>{
    document.getElementById("header").innerHTML =
        "<div style='padding:8px;background:#b91c1c;color:#fff'>Header Load Error</div>";
});

/* ================= CSV HELPER (UNCHANGED LOGIC) ================= */
function downloadCSV(filename, rows){
    const csv = rows.map(r => r.join(",")).join("\n");
    const blob = new Blob([csv], { type:"text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
}

/* ================= REPORT FUNCTIONS =================
   Backend will replace rows later
===================================================== */

function downloadRecoveryStatement(){
    const rows = [["Gen No","Name","Dept","CD","Share","Loan","Interest","Total"]];
    downloadCSV("Recovery_Statement.csv", rows);
}

function downloadRecoverySlips(){
    const rows = [["Gen No","Name","Month","CD","Share","Loan","Interest","Total"]];
    downloadCSV("Recovery_Slips.csv", rows);
}

function downloadEmployeeList(){
    const rows = [["Gen No","Name","Department","Designation","Status"]];
    downloadCSV("Employee_List.csv", rows);
}

function downloadEmployeeTypeReport(){
    const rows = [["Gen No","Name","Employee Type","Department","Status"]];
    downloadCSV("Employee_Type_Report.csv", rows);
}
</script>

</body>
</html>